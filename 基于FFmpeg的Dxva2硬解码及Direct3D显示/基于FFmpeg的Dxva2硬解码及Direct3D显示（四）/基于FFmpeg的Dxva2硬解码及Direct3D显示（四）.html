<!DOCTYPE html>
<!-- saved from url=(0039)https://www.shuzhiduo.com/A/lk5a1WQm51/ -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="applicable-device" content="pc,mobile"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,maximum-scale=1,viewport-fit=cover">
<title>基于FFmpeg的Dxva2硬解码及Direct3D显示（四）</title>	
<link rel="stylesheet" type="text/css" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/prettify.css">
<link rel="stylesheet" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/style.css">
<meta http-equiv="origin-trial" content="A+cA2PUOfIOKAdSDJOW5CP9ZlxONy1yu+hqAq72zUtKw4rLdihqRp6Nui/jUyCyegr+BUtH+C+Elv0ufn05yBQEAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+zsdH3aNZT/bkjT8U/o5ACzyaeNYzTvtoVmwf/KOilfv39pxY2AIsOwhQJv+YnXp98i3TqrQibIVtMWs5UHjgoAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="AxceVEhIegcDEHqLXFQ2+vPKqzCppoJYsRCZ/BdfVnbM/sUUF2BXV8lwNosyYjvoxnTh2FC8cOlAnA5uULr/zAUAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+cA2PUOfIOKAdSDJOW5CP9ZlxONy1yu+hqAq72zUtKw4rLdihqRp6Nui/jUyCyegr+BUtH+C+Elv0ufn05yBQEAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+zsdH3aNZT/bkjT8U/o5ACzyaeNYzTvtoVmwf/KOilfv39pxY2AIsOwhQJv+YnXp98i3TqrQibIVtMWs5UHjgoAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="AxceVEhIegcDEHqLXFQ2+vPKqzCppoJYsRCZ/BdfVnbM/sUUF2BXV8lwNosyYjvoxnTh2FC8cOlAnA5uULr/zAUAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+cA2PUOfIOKAdSDJOW5CP9ZlxONy1yu+hqAq72zUtKw4rLdihqRp6Nui/jUyCyegr+BUtH+C+Elv0ufn05yBQEAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+zsdH3aNZT/bkjT8U/o5ACzyaeNYzTvtoVmwf/KOilfv39pxY2AIsOwhQJv+YnXp98i3TqrQibIVtMWs5UHjgoAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="AxceVEhIegcDEHqLXFQ2+vPKqzCppoJYsRCZ/BdfVnbM/sUUF2BXV8lwNosyYjvoxnTh2FC8cOlAnA5uULr/zAUAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><link rel="preload" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt" as="script"><script src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f.txt"></script><script type="text/javascript" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt"></script><link rel="preload" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt" as="script"><script type="text/javascript" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt"></script><link rel="preload" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt" as="script"><script type="text/javascript" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt"></script><link rel="preload" href="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt" as="script"><script type="text/javascript" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(1).txt"></script></head>
<body style="padding: 0px 0px 120px;">
<div id="header" class="navbar navbar-default navbar-fixed-top header-01">
	<div class="container">
		<h1 class="logo">
			<a href="https://www.shuzhiduo.com/" title="术之多">
							<img src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/logo.png" alt="术之多">
			</a>
		</h1>
				<div role="navigation" class="site-nav  primary-menu">
			<div class="menu-fix-box">
				 <ul id="menu-navigation" class="menu">
<li><a href="https://www.shuzhiduo.com/">首页</a></li>
<li><a href="https://www.shuzhiduo.com/search/Python/">Python</a></li>
<li><a href="https://www.shuzhiduo.com/search/Java/">Java</a></li>
<!-- <li><a href="/search/PHP/">PHP</a></li> -->
<li><a href="https://www.shuzhiduo.com/search/IOS/">IOS</a></li>
<li><a href="https://www.shuzhiduo.com/search/Andorid/">Andorid</a></li>
<li><a href="https://www.shuzhiduo.com/search/NodeJS/">NodeJS</a></li>
<li><a href="https://www.shuzhiduo.com/search/JavaScript/">JavaScript</a></li>
<li><a href="https://www.shuzhiduo.com/search/HTML5/">HTML5</a></li>
</ul>					 			</div>
		</div>
				<!--<div class="right-nav">
				<button class="js-toggle-search"><i class="icon-search"></i></button>
		</div>-->
       
			</div>	
</div>

<div id="page-content" style="height: auto !important;">
	<div class="container" style="height: auto !important;">
		<div class="row" style="height: auto !important;">
			
			<div class="blog-post" style="height: auto !important;">
								<!--<div class="posts-top-cjtz clearfix"></div>-->
								<div class="post" style="height: auto !important;">
										<div class="post-title" style="height: auto !important;">
											<div style="height: 280px;"><script src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(2).txt"></script><script src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/hm.js.下载"></script><script src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(3).txt" id="google_shimpl"></script><script async="" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(4).txt" crossorigin="anonymous" data-checked-head="true"></script>
<ins class="adsbygoogle" style="display: block; height: 280px;" data-ad-client="ca-pub-9051032955849697" data-ad-slot="7026798921" data-ad-format="auto" data-full-width-responsive="true" data-adsbygoogle-status="done" data-ad-status="filled"><div id="aswift_1_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none; height: 280px; width: 1120px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block; overflow: visible;"><iframe id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;border:0;width:1120px;height:280px;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="1120" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/ads.html" data-google-container-id="a!2" data-google-query-id="CJqLweXNpfoCFW-C6QUdyxQOjA" data-load-complete="true"></iframe></div></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
						<!--<div class="post-entry-categories"><a href="/tag/abc" rel="tag">tag</a><a href="/tag/abc" rel="tag">tag2</a></div>-->
						<h1 class="title">基于FFmpeg的Dxva2硬解码及Direct3D显示（四）</h1>
						<div class="post_icon"> 
															<span class="icon-user-o"> 葫芦娃508</span>															
															<span class="icon-clock-1"> 2019-01-22 </span>
															<span class="icon-article-1"> <a href="https://www.shuzhiduo.com/link/bGs1YTFXUW01MQ==" target="_blank" rel="noindex,nofollow,oarchive">原文</a> </span>
					</div>
										<div class="post-content" style="height: auto !important;">
													<div style="height: 280px;"><script async="" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(4).txt" crossorigin="anonymous" data-checked-head="true"></script>
<ins class="adsbygoogle" style="display: block; height: 280px;" data-ad-client="ca-pub-9051032955849697" data-ad-slot="7026798921" data-ad-format="auto" data-full-width-responsive="true" data-adsbygoogle-status="done" data-ad-status="filled"><div id="aswift_2_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none; height: 280px; width: 1120px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block; overflow: visible;"><iframe id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;border:0;width:1120px;height:280px;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="1120" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/ads(1).html" data-google-container-id="a!3" data-google-query-id="CKjBweXNpfoCFTGG6QUdACAF4A" data-load-complete="true"></iframe></div></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
											
		<h2>初始化硬解码上下文</h2>
<div>
<div>目录</div>
<ul><li><a href="https://www.shuzhiduo.com/A/lk5a1WQm51/#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%A1%AC%E8%A7%A3%E7%A0%81%E4%B8%8A%E4%B8%8B%E6%96%87" rel="external nofollow noreferrer">初始化硬解码上下文</a>
<ul><li><a href="https://www.shuzhiduo.com/A/lk5a1WQm51/#%E5%88%9B%E5%BB%BA%E8%A7%A3%E7%A0%81%E6%95%B0%E6%8D%AE%E7%BC%93%E5%86%B2%E5%8C%BA" rel="external nofollow noreferrer">创建解码数据缓冲区</a></li>
<li><a href="https://www.shuzhiduo.com/A/lk5a1WQm51/#%E5%88%9B%E5%BB%BAidirectxvideodecoder%E8%A7%86%E9%A2%91%E8%A7%A3%E7%A0%81%E5%99%A8" rel="external nofollow noreferrer">创建IDirectXVideoDecoder视频解码器</a></li>
<li><a href="https://www.shuzhiduo.com/A/lk5a1WQm51/#%E8%AE%BE%E7%BD%AE%E7%A1%AC%E8%A7%A3%E7%A0%81%E4%B8%8A%E4%B8%8B%E6%96%87" rel="external nofollow noreferrer">设置硬解码上下文</a></li>
<li><a href="https://www.shuzhiduo.com/A/lk5a1WQm51/#%E8%A7%A3%E7%A0%81%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0" rel="external nofollow noreferrer">解码回调函数</a></li></ul></li></ul>
</div>
<h3>创建解码数据缓冲区</h3>
<p>这一步为了得到 LPDIRECT3DSURFACE9* 实例 m_pSurface，就是之前说过的那个数组。</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="com">// m_surfaceNums 为希望创建的缓冲区个数，单路视频一个就够了，太多可能显存不够用</span><br></code></li><li class="L1"><code><span class="pln">m_pSurface </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">LPDIRECT3DSURFACE9</span><span class="pun">*)</span><span class="pln">av_mallocz</span><span class="pun">(</span><span class="pln">m_surfaceNums </span><span class="pun">*</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">LPDIRECT3DSURFACE9</span><span class="pun">));</span><br></code></li><li class="L2"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">m_pSurface</span><span class="pun">)</span><br></code></li><li class="L3"><code><span class="pun">{</span><br></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">// 字节对齐</span><br></code></li><li class="L8"><code><span class="kwd">int</span><span class="pln"> surfaceAlignment </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><br></code></li><li class="L9"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">codec_id </span><span class="pun">==</span><span class="pln"> AV_CODEC_ID_MPEG2VIDEO</span><span class="pun">)</span><br></code></li><li class="L0"><code><span class="pun">{</span><br></code></li><li class="L1"><code><span class="pln">    surfaceAlignment </span><span class="pun">=</span><span class="pln"> </span><span class="lit">32</span><span class="pun">;</span><br></code></li><li class="L2"><code><span class="pun">}</span><br></code></li><li class="L3"><code><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">codec_id </span><span class="pun">==</span><span class="pln"> AV_CODEC_ID_HEVC</span><span class="pun">)</span><br></code></li><li class="L4"><code><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">    surfaceAlignment </span><span class="pun">=</span><span class="pln"> </span><span class="lit">128</span><span class="pun">;</span><br></code></li><li class="L6"><code><span class="pun">}</span><br></code></li><li class="L7"><code><span class="kwd">else</span><br></code></li><li class="L8"><code><span class="pun">{</span><br></code></li><li class="L9"><code><span class="pln">    surfaceAlignment </span><span class="pun">=</span><span class="pln"> </span><span class="lit">16</span><span class="pun">;</span><br></code></li><li class="L0"><code><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="com">// 创建缓冲区</span><br></code></li><li class="L3"><code><span class="pln">HRESULT hr </span><span class="pun">=</span><span class="pln"> m_pDecoderService</span><span class="pun">-&gt;</span><span class="typ">CreateSurface</span><span class="pun">(</span><br></code></li><li class="L4"><code><span class="pln">    FFALIGN</span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">coded_width</span><span class="pun">,</span><span class="pln"> surfaceAlignment</span><span class="pun">),</span><span class="pln">	</span><span class="com">// 缓冲区宽</span><br></code></li><li class="L5"><code><span class="pln">    FFALIGN</span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">coded_height</span><span class="pun">,</span><span class="pln"> surfaceAlignment</span><span class="pun">),</span><span class="pln">	</span><span class="com">// 缓冲区高</span><br></code></li><li class="L6"><code><span class="pln">    m_surfaceNums</span><span class="pun">,</span><span class="pln">					</span><span class="com">// 缓冲区个数，这里可以设置为0，CreateVideoDecoder里面会重新设置个数</span><br></code></li><li class="L7"><code><span class="pln">    m_renderFormat</span><span class="pun">,</span><span class="pln">					</span><span class="com">// 缓冲区格式</span><br></code></li><li class="L8"><code><span class="pln">    D3DPOOL_DEFAULT</span><span class="pun">,</span><span class="pln">				</span><span class="com">// 缓冲区位置，D3DPOOL_DEFAULT--显存</span><br></code></li><li class="L9"><code><span class="pln">    </span><span class="lit">0</span><span class="pun">,</span><span class="pln">								</span><span class="com">// 资源如何被使用</span><br></code></li><li class="L0"><code><span class="pln">    DXVA2_VideoDecoderRenderTarget</span><span class="pun">,</span><span class="pln">	</span><span class="com">// 缓冲区为视频解码器渲染目标</span><br></code></li><li class="L1"><code><span class="pln">    m_pSurface</span><span class="pun">,</span><span class="pln">						</span><span class="com">// 缓冲区数组指针</span><br></code></li><li class="L2"><code><span class="pln">    NULL</span><span class="pun">);</span><span class="pln">							</span><span class="com">// 保留字</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">FAILED</span><span class="pun">(</span><span class="pln">hr</span><span class="pun">))</span><br></code></li><li class="L5"><code><span class="pun">{</span><br></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L7"><code><span class="pun">}</span><br></code></li></ol></pre>
<h3>创建IDirectXVideoDecoder视频解码器</h3>
<ol><li>获取当前GPU支持的解码能力等级和渲染格式</li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="pln">BOOL </span><span class="typ">GetDxva2FormatAndGuid</span><span class="pun">(</span><span class="typ">AVCodecContext</span><span class="pln"> </span><span class="pun">*</span><span class="pln">pCodecCtx</span><span class="pun">,</span><span class="pln"> GUID </span><span class="pun">&amp;</span><span class="pln"> guid</span><span class="pun">,</span><span class="pln"> D3DFORMAT </span><span class="pun">&amp;</span><span class="pln"> fmt</span><span class="pun">)</span><br></code></li><li class="L1"><code><span class="pun">{</span><br></code></li><li class="L2"><code><span class="pln">	</span><span class="com">// 获取当前设备支持的解码标准等级标识列表</span><br></code></li><li class="L3"><code><span class="pln">	GUID </span><span class="pun">*</span><span class="pln">guidList </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span><br></code></li><li class="L4"><code><span class="pln">	</span><span class="kwd">unsigned</span><span class="pln"> guidCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">	HRESULT hr </span><span class="pun">=</span><span class="pln"> m_pDecoderService</span><span class="pun">-&gt;</span><span class="typ">GetDecoderDeviceGuids</span><span class="pun">(&amp;</span><span class="pln">guidCount</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">guidList</span><span class="pun">);</span><br></code></li><li class="L7"><code><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">FAILED</span><span class="pun">(</span><span class="pln">hr</span><span class="pun">))</span><br></code></li><li class="L8"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L9"><code><span class="pln">		VX_LOG_ERROR</span><span class="pun">(</span><span class="str">"Get hardware acclerate device guids failed!"</span><span class="pun">);</span><br></code></li><li class="L0"><code><span class="pln">		</span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L1"><code><span class="pln">	</span><span class="pun">}</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><br></code></li><li class="L4"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">NULL </span><span class="pun">==</span><span class="pln"> guid2AVCodecID</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">guidID</span><span class="pun">)</span><br></code></li><li class="L6"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L7"><code><span class="pln">			</span><span class="com">// 查到最后一个了直接退出循环</span><br></code></li><li class="L8"><code><span class="pln">			</span><span class="kwd">break</span><span class="pun">;</span><br></code></li><li class="L9"><code><span class="pln">		</span><span class="pun">}</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">		</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Guid2CodecID</span><span class="pln"> </span><span class="pun">*</span><span class="pln">mode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">guid2AVCodecID</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mode</span><span class="pun">-&gt;</span><span class="pln">codecID </span><span class="pun">==</span><span class="pln"> pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">codec_id</span><span class="pun">)</span><br></code></li><li class="L4"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">			</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint32_t</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> guidCount</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><br></code></li><li class="L6"><code><span class="pln">			</span><span class="pun">{</span><br></code></li><li class="L7"><code><span class="pln">				</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IsEqualGUID</span><span class="pun">(*</span><span class="pln">mode</span><span class="pun">-&gt;</span><span class="pln">guidID</span><span class="pun">,</span><span class="pln"> guidList</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]))</span><br></code></li><li class="L8"><code><span class="pln">				</span><span class="pun">{</span><br></code></li><li class="L9"><code><span class="pln">					</span><span class="com">// 获取当前解码标准下渲染器目标格式数组</span><br></code></li><li class="L0"><code><span class="pln">					D3DFORMAT </span><span class="pun">*</span><span class="pln">targetList </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span><br></code></li><li class="L1"><code><span class="pln">					UINT targetCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><br></code></li><li class="L2"><code><span class="pln">					hr </span><span class="pun">=</span><span class="pln"> m_pDecoderService</span><span class="pun">-&gt;</span><span class="typ">GetDecoderRenderTargets</span><span class="pun">(*</span><span class="pln">mode</span><span class="pun">-&gt;</span><span class="pln">guidID</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">targetCount</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">targetList</span><span class="pun">);</span><br></code></li><li class="L3"><code><span class="pln">					</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">FAILED</span><span class="pun">(</span><span class="pln">hr</span><span class="pun">))</span><br></code></li><li class="L4"><code><span class="pln">					</span><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">						VX_LOG_ERROR</span><span class="pun">(</span><span class="str">"Get support render format failed!"</span><span class="pun">);</span><br></code></li><li class="L6"><code><span class="pln">						</span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L7"><code><span class="pln">					</span><span class="pun">}</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">					</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint32_t</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> targetCount</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><br></code></li><li class="L0"><code><span class="pln">					</span><span class="pun">{</span><br></code></li><li class="L1"><code><span class="pln">						</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">targetList</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> MKTAG</span><span class="pun">(</span><span class="str">'N'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'V'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span class="pun">))</span><br></code></li><li class="L2"><code><span class="pln">						</span><span class="pun">{</span><br></code></li><li class="L3"><code><span class="pln">							fmt </span><span class="pun">=</span><span class="pln"> targetList</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><br></code></li><li class="L4"><code><span class="pln">							guid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="pln">mode</span><span class="pun">-&gt;</span><span class="pln">guidID</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pln">							</span><span class="kwd">break</span><span class="pun">;</span><br></code></li><li class="L6"><code><span class="pln">						</span><span class="pun">}</span><br></code></li><li class="L7"><code><span class="pln">					</span><span class="pun">}</span><br></code></li><li class="L8"><code><span class="pln">					</span><span class="com">// 释放内存资源</span><br></code></li><li class="L9"><code><span class="pln">					</span><span class="typ">CoTaskMemFree</span><span class="pun">(</span><span class="pln">targetList</span><span class="pun">);</span><br></code></li><li class="L0"><code><span class="pln">				</span><span class="pun">}</span><br></code></li><li class="L1"><code><span class="pln">			</span><span class="pun">}</span><br></code></li><li class="L2"><code><span class="pln">		</span><span class="pun">}</span><br></code></li><li class="L3"><code><span class="pln">	</span><span class="pun">}</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">	</span><span class="typ">CoTaskMemFree</span><span class="pun">(</span><span class="pln">guidList</span><span class="pun">);</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">D3DFMT_UNKNOWN </span><span class="pun">==</span><span class="pln"> fmt </span><span class="pun">||</span><span class="pln"> GUID_NULL </span><span class="pun">==</span><span class="pln"> guid</span><span class="pun">)</span><br></code></li><li class="L8"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L9"><code><span class="pln">		</span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L0"><code><span class="pln">	</span><span class="pun">}</span><br></code></li><li class="L1"><code><span class="pln">	</span><span class="kwd">else</span><br></code></li><li class="L2"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L3"><code><span class="pln">		</span><span class="kwd">return</span><span class="pln"> TRUE</span><span class="pun">;</span><br></code></li><li class="L4"><code><span class="pln">	</span><span class="pun">}</span><br></code></li><li class="L5"><code><span class="pun">}</span><br></code></li></ol></pre>
<ol><li>获取当前解码等级下的配置信息</li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">void</span><span class="pln"> </span><span class="typ">CDxva2Decode</span><span class="pun">::</span><span class="typ">GetDecoderCfg</span><span class="pun">(</span><span class="typ">AVCodecContext</span><span class="pln"> </span><span class="pun">*</span><span class="pln">pCodecCtx</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> GUID </span><span class="pun">*</span><span class="pln">pGuid</span><span class="pun">,</span><br></code></li><li class="L1"><code><span class="pln">								</span><span class="kwd">const</span><span class="pln"> DXVA2_VideoDesc </span><span class="pun">*</span><span class="pln">pDesc</span><span class="pun">,</span><span class="pln"> DXVA2_ConfigPictureDecode </span><span class="pun">*</span><span class="pln">pCfg</span><span class="pun">)</span><br></code></li><li class="L2"><code><span class="pun">{</span><br></code></li><li class="L3"><code><span class="pln">	</span><span class="kwd">unsigned</span><span class="pln"> cfgCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> bestScore </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><br></code></li><li class="L4"><code><span class="pln">	DXVA2_ConfigPictureDecode </span><span class="pun">*</span><span class="pln">cfgList </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">	HRESULT hr </span><span class="pun">=</span><span class="pln"> m_pDecoderService</span><span class="pun">-&gt;</span><span class="typ">GetDecoderConfigurations</span><span class="pun">(*</span><span class="pln">pGuid</span><span class="pun">,</span><span class="pln"> pDesc</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">cfgCount</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">cfgList</span><span class="pun">);</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint32_t</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> cfgCount</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><br></code></li><li class="L9"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L0"><code><span class="pln">		DXVA2_ConfigPictureDecode cfg </span><span class="pun">=</span><span class="pln"> cfgList</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">		</span><span class="kwd">unsigned</span><span class="pln"> score</span><span class="pun">;</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cfg</span><span class="pun">.</span><span class="typ">ConfigBitstreamRaw</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><br></code></li><li class="L5"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L6"><code><span class="pln">			score </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><br></code></li><li class="L7"><code><span class="pln">		</span><span class="pun">}</span><br></code></li><li class="L8"><code><span class="pln">		</span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">codec_id </span><span class="pun">==</span><span class="pln"> AV_CODEC_ID_H264 </span><span class="pun">&amp;&amp;</span><span class="pln"> cfg</span><span class="pun">.</span><span class="typ">ConfigBitstreamRaw</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><br></code></li><li class="L9"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L0"><code><span class="pln">			score </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><br></code></li><li class="L1"><code><span class="pln">		</span><span class="pun">}</span><br></code></li><li class="L2"><code><span class="pln">		</span><span class="kwd">else</span><br></code></li><li class="L3"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L4"><code><span class="pln">			</span><span class="kwd">continue</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pln">		</span><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IsEqualGUID</span><span class="pun">(</span><span class="pln">cfg</span><span class="pun">.</span><span class="pln">guidConfigBitstreamEncryption</span><span class="pun">,</span><span class="pln"> DXVA2_NoEncrypt</span><span class="pun">))</span><br></code></li><li class="L8"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L9"><code><span class="pln">			score </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">16</span><span class="pun">;</span><br></code></li><li class="L0"><code><span class="pln">		</span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">score </span><span class="pun">&gt;</span><span class="pln"> bestScore</span><span class="pun">)</span><br></code></li><li class="L3"><code><span class="pln">		</span><span class="pun">{</span><br></code></li><li class="L4"><code><span class="pln">			bestScore </span><span class="pun">=</span><span class="pln"> score</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pln">			</span><span class="pun">*</span><span class="pln">pCfg </span><span class="pun">=</span><span class="pln"> cfg</span><span class="pun">;</span><br></code></li><li class="L6"><code><span class="pln">		</span><span class="pun">}</span><br></code></li><li class="L7"><code><span class="pln">	</span><span class="pun">}</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">	</span><span class="typ">CoTaskMemFree</span><span class="pun">(</span><span class="pln">cfgList</span><span class="pun">);</span><br></code></li><li class="L0"><code><span class="pun">}</span><br></code></li></ol></pre>
<ol><li>这一步为了得到 IDirectXVideoDecoder* 实例 m_pDxva2Decoder，亦即硬件解码器。</li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="typ">GetDxva2FormatAndGuid</span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">,</span><span class="pln"> m_decoderGuid</span><span class="pun">,</span><span class="pln"> m_renderFormat</span><span class="pun">))</span><br></code></li><li class="L1"><code><span class="pun">{</span><br></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 不支持DXVA2加速</span><br></code></li><li class="L3"><code><span class="pln">    VX_LOG_ERROR</span><span class="pun">(</span><span class="str">"Do not support Dxva2!"</span><span class="pun">);</span><br></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">// 设置解码后的格式</span><br></code></li><li class="L8"><code><span class="pln">DXVA2_VideoDesc desc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">};</span><br></code></li><li class="L9"><code><span class="pln">desc</span><span class="pun">.</span><span class="typ">SampleWidth</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">coded_width</span><span class="pun">;</span><br></code></li><li class="L0"><code><span class="pln">desc</span><span class="pun">.</span><span class="typ">SampleHeight</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">coded_height</span><span class="pun">;</span><br></code></li><li class="L1"><code><span class="pln">desc</span><span class="pun">.</span><span class="typ">Format</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> m_renderFormat</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">// 获取支持的配置</span><br></code></li><li class="L4"><code><span class="typ">GetDecoderCfg</span><span class="pun">(</span><span class="pln">pCodecCtx</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">m_decoderGuid</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">desc</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">m_config</span><span class="pun">);</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="com">// 创建解码器设备</span><br></code></li><li class="L7"><code><span class="pln">HRESULT hr </span><span class="pun">=</span><span class="pln"> m_pDecoderService</span><span class="pun">-&gt;</span><span class="typ">CreateVideoDecoder</span><span class="pun">(</span><span class="pln">m_decoderGuid</span><span class="pun">,</span><span class="pln">		</span><span class="com">// 设备标识符</span><br></code></li><li class="L8"><code><span class="pln">                                                   </span><span class="pun">&amp;</span><span class="pln">desc</span><span class="pun">,</span><span class="pln">				</span><span class="com">// 视频内容描述</span><br></code></li><li class="L9"><code><span class="pln">                                                   </span><span class="pun">&amp;</span><span class="pln">m_config</span><span class="pun">,</span><span class="pln">			</span><span class="com">// 解码器配置</span><br></code></li><li class="L0"><code><span class="pln">                                                   m_pSurface</span><span class="pun">,</span><span class="pln">			</span><span class="com">// 渲染目标数组指针(解码后的数据写到这里)</span><br></code></li><li class="L1"><code><span class="pln">                                                   m_surfaceNums</span><span class="pun">,</span><span class="pln">		</span><span class="com">// 渲染目标数，必须大于0，</span><br></code></li><li class="L2"><code><span class="pln">                                                   </span><span class="pun">&amp;</span><span class="pln">m_pDxva2Decoder</span><span class="pun">);</span><span class="pln">	</span><span class="com">// 解码器</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">FAILED</span><span class="pun">(</span><span class="pln">hr</span><span class="pun">))</span><br></code></li><li class="L5"><code><span class="pun">{</span><br></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L7"><code><span class="pun">}</span><br></code></li></ol></pre>
<h3>设置硬解码上下文</h3>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="com">// 这一步为了将解码缓冲区数组传给GetBufferCallBack回调函数</span><br></code></li><li class="L1"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">opaque </span><span class="pun">=</span><span class="pln"> m_pSurface</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">// 设置回调</span><br></code></li><li class="L4"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">get_buffer2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GetBufferCallBack</span><span class="pun">;</span><br></code></li><li class="L5"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">get_format </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GetHwFormat</span><span class="pun">;</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">// 单路视频启动多线程解码，理解是启用多个线程将待解码数据送往GPU，因为数据从内存到显存比较慢</span><br></code></li><li class="L8"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">thread_safe_callbacks </span><span class="pun">=</span><span class="pln"> TRUE</span><span class="pun">;</span><br></code></li><li class="L9"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">thread_count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="com">// 为解码器上下文申请硬件加速内存</span><br></code></li><li class="L2"><code><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">hwaccel_context </span><span class="pun">=</span><span class="pln"> av_mallocz</span><span class="pun">(</span><span class="kwd">sizeof</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> dxva_context</span><span class="pun">));</span><br></code></li><li class="L3"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">hwaccel_context</span><span class="pun">)</span><br></code></li><li class="L4"><code><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> FALSE</span><span class="pun">;</span><br></code></li><li class="L6"><code><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="com">// 设置硬件加速上下文</span><br></code></li><li class="L9"><code><span class="kwd">struct</span><span class="pln"> dxva_context </span><span class="pun">*</span><span class="pln">dxva2Ctx </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dxva_context </span><span class="pun">*)</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">hwaccel_context</span><span class="pun">;</span><br></code></li><li class="L0"><code><span class="pln">dxva2Ctx</span><span class="pun">-&gt;</span><span class="pln">cfg </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">m_config</span><span class="pun">;</span><br></code></li><li class="L1"><code><span class="pln">dxva2Ctx</span><span class="pun">-&gt;</span><span class="pln">decoder </span><span class="pun">=</span><span class="pln"> m_pDecoder</span><span class="pun">;</span><br></code></li><li class="L2"><code><span class="pln">dxva2Ctx</span><span class="pun">-&gt;</span><span class="pln">surface </span><span class="pun">=</span><span class="pln"> m_pSurface</span><span class="pun">;</span><br></code></li><li class="L3"><code><span class="pln">dxva2Ctx</span><span class="pun">-&gt;</span><span class="pln">surface_count </span><span class="pun">=</span><span class="pln"> m_surfaceNums</span><span class="pun">;</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="com">// 对老的intel GPU 的支持</span><br></code></li><li class="L6"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IsEqualGUID</span><span class="pun">(</span><span class="pln">m_decoderGuid</span><span class="pun">,</span><span class="pln"> DXVADDI_Intel_ModeH264_E</span><span class="pun">))</span><br></code></li><li class="L7"><code><span class="pun">{</span><br></code></li><li class="L8"><code><span class="pln">    dxva2Ctx</span><span class="pun">-&gt;</span><span class="pln">workaround </span><span class="pun">|=</span><span class="pln"> FF_DXVA2_WORKAROUND_INTEL_CLEARVIDEO</span><span class="pun">;</span><br></code></li><li class="L9"><code><span class="pun">}</span><br></code></li></ol></pre>
<h3>解码回调函数</h3>
<ol><li>解码输出格式回调</li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">static</span><span class="pln"> </span><span class="typ">AVPixelFormat</span><span class="pln"> </span><span class="typ">GetHwFormat</span><span class="pun">(</span><span class="typ">AVCodecContext</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pCodecCtx</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="typ">AVPixelFormat</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pPixFmt</span><span class="pun">)</span><br></code></li><li class="L1"><code><span class="pun">{</span><br></code></li><li class="L2"><code><span class="pln">	</span><span class="com">// 因为采用的是DXVA2，所以这里直接写死了</span><br></code></li><li class="L3"><code><span class="pln">	</span><span class="kwd">return</span><span class="pln"> AV_PIX_FMT_DXVA2_VLD</span><span class="pun">;</span><br></code></li><li class="L4"><code><span class="pun">}</span><br></code></li></ol></pre>
<ol><li><p>解码数据回调</p>
<p>此时解码后的数据放在解码缓冲数组里面，这里数组大小为1。单路视频时 pFrame 地址为两个固定地址切换，这些应该都是FFmpeg内部实现的。这里理解的不清楚，希望大神可以指点。</p></li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="com">// 个人理解就是将LPDIRECT3DSURFACE9转为(uint8_t *)，同时得保证内存不会立即被释放</span><br></code></li><li class="L1"><code><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="typ">GetBufferCallBack</span><span class="pun">(</span><span class="typ">AVCodecContext</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pCodecCtx</span><span class="pun">,</span><span class="pln"> </span><span class="typ">AVFrame</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pFrame</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> flags</span><span class="pun">)</span><br></code></li><li class="L2"><code><span class="pun">{</span><br></code></li><li class="L3"><code><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pFrame</span><span class="pun">-&gt;</span><span class="pln">format </span><span class="pun">!=</span><span class="pln"> AV_PIX_FMT_DXVA2_VLD</span><span class="pun">)</span><br></code></li><li class="L4"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L5"><code><span class="pln">		</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><br></code></li><li class="L6"><code><span class="pln">	</span><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">	</span><span class="com">// 获取解码后的数据，出于安全性不可直接访问，这一步没有内存拷贝</span><br></code></li><li class="L9"><code><span class="pln">	LPDIRECT3DSURFACE9 surface </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">LPDIRECT3DSURFACE9</span><span class="pun">*)(</span><span class="pln">pCodecCtx</span><span class="pun">-&gt;</span><span class="pln">opaque</span><span class="pun">))[</span><span class="lit">0</span><span class="pun">];</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">	</span><span class="com">// 将LPDIRECT3DSURFACE9转为AVBuffer，内存地址不变，并返回AVBufferRef，并返回AVBufferRef供FFmpeg内部使用，这一步应该发生了内存拷贝</span><br></code></li><li class="L2"><code><span class="pln">	</span><span class="com">// 类似于智能指针，增加对surface的引用计数，当计数为0时FFmpeg会认为该帧数据丢弃掉。默认使用av_buffer_default_free释放，</span><br></code></li><li class="L3"><code><span class="pln">	pFrame</span><span class="pun">-&gt;</span><span class="pln">buf</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> av_buffer_create</span><span class="pun">((</span><span class="typ">uint8_t</span><span class="pun">*)</span><span class="pln">surface</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">nullptr</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">nullptr</span><span class="pun">,</span><span class="pln"> AV_BUFFER_FLAG_READONLY</span><span class="pun">);</span><br></code></li><li class="L4"><code><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">pFrame</span><span class="pun">-&gt;</span><span class="pln">buf</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span><br></code></li><li class="L5"><code><span class="pln">	</span><span class="pun">{</span><br></code></li><li class="L6"><code><span class="pln">		</span><span class="kwd">return</span><span class="pln"> AVERROR</span><span class="pun">(</span><span class="pln">ENOMEM</span><span class="pun">);</span><br></code></li><li class="L7"><code><span class="pln">	</span><span class="pun">}</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">	</span><span class="com">// 这一步拿到最终可以显示的数据，必须是data[3]，此时surface应该是AVBuffer</span><br></code></li><li class="L0"><code><span class="pln">	pFrame</span><span class="pun">-&gt;</span><span class="pln">data</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint8_t</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">surface</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><br></code></li><li class="L3"><code><span class="pun">}</span><br></code></li></ol></pre>
<p>[参考链接]：（<a href="http://www.cnblogs.com/betterwgo/p/6125507.html%EF%BC%89" rel="external nofollow noreferrer">http://www.cnblogs.com/betterwgo/p/6125507.html）</a></p>												<div style="height: 280px;"><script async="" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/f(4).txt" crossorigin="anonymous" data-checked-head="true"></script>
<ins class="adsbygoogle" style="display: block; height: 280px;" data-ad-client="ca-pub-9051032955849697" data-ad-slot="7026798921" data-ad-format="auto" data-full-width-responsive="true" data-adsbygoogle-status="done" data-ad-status="filled"><div id="aswift_3_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none; height: 280px; width: 1120px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block; overflow: visible;"><iframe id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;border:0;width:1120px;height:280px;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="1120" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-9051032955849697&amp;output=html&amp;h=280&amp;slotname=7026798921&amp;adk=536506838&amp;adf=2625565989&amp;pi=t.ma~as.7026798921&amp;w=1120&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1663753790&amp;rafmt=1&amp;psa=1&amp;format=1120x280&amp;url=https%3A%2F%2Fwww.shuzhiduo.com%2FA%2Flk5a1WQm51%2F&amp;fwr=0&amp;fwrattr=true&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;uach=WyJXaW5kb3dzIiwiMC4xLjAiLCJ4ODYiLCIiLCIxMDUuMC41MTk1LjEyNyIsW10sZmFsc2UsbnVsbCwiNjQiLFtbIkdvb2dsZSBDaHJvbWUiLCIxMDUuMC41MTk1LjEyNyJdLFsiTm90KUE7QnJhbmQiLCI4LjAuMC4wIl0sWyJDaHJvbWl1bSIsIjEwNS4wLjUxOTUuMTI3Il1dLGZhbHNlXQ..&amp;dt=1663753772903&amp;bpp=1&amp;bdt=61&amp;idt=101&amp;shv=r20220915&amp;mjsv=m202209080101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3Df7314187d1585458-22ff8ab370cc0073%3AT%3D1634204227%3ART%3D1634204227%3AS%3DALNI_MahjDhlS5l9lyCPEBuoCBwD88Q75A&amp;gpic=UID%3D000009d3255c3bad%3AT%3D1663751820%3ART%3D1663751820%3AS%3DALNI_Mas9m9Ujtd4Rak-tm0JxwicINSJVw&amp;prev_fmts=0x0%2C1120x280%2C1120x280%2C728x90&amp;nras=2&amp;correlator=3645671886148&amp;frm=20&amp;pv=1&amp;ga_vid=1484284127.1663753773&amp;ga_sid=1663753773&amp;ga_hid=377792994&amp;ga_fc=0&amp;u_tz=480&amp;u_his=9&amp;u_h=1440&amp;u_w=2560&amp;u_ah=1400&amp;u_aw=2560&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=712&amp;ady=6829&amp;biw=2543&amp;bih=1240&amp;scr_x=0&amp;scr_y=1930&amp;eid=44759876%2C44759927%2C44759842%2C42531705%2C44773614&amp;oid=2&amp;psts=APxP-9DwjU3w9ms9Gz4QzLnT05b73LnFkx48gZtKvNfsP3X0tVbNEJFRlMUVe8oBrvnePCKwQrvHuS1JPEX_4sE6iQ%2CAPxP-9DiA3sGF-Fir_gEoKxJ59MvXVaIkB_DFFzlNiWvrjmNBu-ONO44dqCH5CKV0zlWNlY6fYQgYb68hA2v6ep4kA&amp;pvsid=2296454610742570&amp;tmod=2134688571&amp;uas=3&amp;nvt=1&amp;ref=https%3A%2F%2Fwww.shuzhiduo.com%2FA%2F8Bz8qOYXJx%2F&amp;eae=0&amp;fc=1920&amp;brdim=0%2C0%2C0%2C0%2C2560%2C0%2C2560%2C1400%2C2560%2C1240&amp;vis=1&amp;rsz=%7C%7CeEbr%7C&amp;abl=CS&amp;pfx=0&amp;fu=128&amp;bc=31&amp;ifi=4&amp;uci=a!4&amp;btvi=2&amp;fsb=1&amp;xpc=N8FCPogue3&amp;p=https%3A//www.shuzhiduo.com&amp;dtd=17913" data-google-container-id="a!4" data-google-query-id="CMLugO7NpfoCFdHUfAodQAAMbA" data-load-complete="true"></iframe></div></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
											<h2><a href="https://www.shuzhiduo.com/R/lk5a1WQm51/">基于FFmpeg的Dxva2硬解码及Direct3D显示（四）的更多相关文章</a></h2>	
<ol>
								<li><a href="https://www.shuzhiduo.com/A/rV57q0YXzP/">基于FFmpeg的Dxva2硬解码及Direct3D显示（一）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">目录 前言 名词解释 代码实现逻辑 前言 关于视频软解码的资料网上比较多了,但是关于硬解可供参考的资料非常之有限,虽然总得来说软解和硬解的基本逻辑一样,但是实现细节上的差别还是比较多的.虽然目前功能已 ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/A7zgQ8No54/">基于FFmpeg的Dxva2硬解码及Direct3D显示（五）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">解码及显示 目录 解码及显示 解码 显示 资源清理 解码 循环读取视频帧 AVPacket packet = { 0 }; while (av_read_frame(m_pFmtCtx, &amp;p ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/8Bz8qOYXJx/">基于FFmpeg的Dxva2硬解码及Direct3D显示（三）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">初始化Direct3D 目录 初始化Direct3D 创建Direct3D物理设备对象实例 创建Direct3D渲染设备实例 创建Direct3D视频解码服务 Direct3D渲染可以通过Surfac ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/A2dmDyAg5e/">基于FFmpeg的Dxva2硬解码及Direct3D显示（二）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">解析视频源 目录 解析视频源 获取视频流 解析视频流 说明:这篇博文分为"获取视频流"和"解析视频流"两个部分,使用的是FFmpeg4.1的版本,与网上流传的低 ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/gVdn7XrQzW/">使用C#+FFmpeg+DirectX+dxva2硬件解码播放h264流</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">本文门槛较高,因此行文看起来会乱一些,如果你看到某处能会心一笑请马上联系我开始摆龙门阵 如果你跟随这篇文章实现了播放器,那你会得到一个高效率,低cpu占用(单路720p视频解码播放占用1%左右cpu) ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/kvJ3Q8a9dg/">【视频开发】 ffmpeg支持的硬解码接口</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">To enable DXVA2, use the&nbsp;--enable-dxva2&nbsp;ffmpeg configure switch. To test decoding, use the following ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/ZOJPZXYedv/">[原]ffmpeg编译android 硬解码支持库 libstagefright</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">最近花了一天时间将ffmpeg/tools/build_stagefright执行成功,主要是交叉编译所需要的各种动态库的支持没链接上,导致各种报错,基本上网络上问到的问题我都碰到了,特此记录下来.  ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/WpdKGYmqdV/">【并行计算与CUDA开发】基于NVIDIA显卡的硬编解码的一点心得 （完结）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">原文:基于NVIDIA显卡的硬编解码的一点心得 (完结) 1.硬解码软编码方法:大体流程,先用ffmpeg来读取视频文件的包,接着开启两个线程,一个用于硬解码,一个用于软编码,然后将读取的包传给解码器 ...</p>
		</li>
						<li><a href="https://www.shuzhiduo.com/A/Ae5RoVG3dQ/">最简单的基于FFMPEG的封装格式转换器（无编解码）</a>
		<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">本文介绍一个基于FFMPEG的封装格式转换器.所谓的封装格式转换,就是在AVI,FLV,MKV,MP4这些格式之间转换(相应.avi,.flv,.mkv,.mp4文件).须要注意的是,本程序并不进行视 ...</p>
		</li>
		</ol>
	

<h2>随机推荐</h2>	
<ol>
									<li><a href="https://www.shuzhiduo.com/A/B0zqY27Xzv/">iOS开发--JSON</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">1.什么是JSON? JSON(JavaScript Object Notation)在网络传输中几乎无处不在,JSON是一种轻量级的数据交换格式,是基于JavaScript(Standard ECM ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/Ae5Ryk0YJQ/">图解TCP/IP读书笔记（三）</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">第三章.数据链路 数据链路层是计算机网络最基本的内容. 数据链路层的协议定义了通过通信媒介互连的设备之间传输的规范. 一.数据链路相关技术 1.MAC地址 关于MAC地址的几个要点: ①MAC地址长度 ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/QV5ZjlOn5y/">Android_listView_exc</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">listView布局: &lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"  ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/1O5EpEEbJ7/">暴力+树状数组维护  Codeforces Round #378 (Div. 2) C</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">题目大意:给你一个长度为n的数组a,然后数值大的可以合并数值小的,且合并了以后该数组的长度-1.给你一个长度为k目标数组b,问,是否可以从a数组变到b数组,是就yes并且输出步骤.否就输出no 思路: ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/gAJGPNOo5Z/">javascript中的原型继承</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">在Javascript面向对象编程中,原型继承不仅是一个重点也是一个不容易掌握的点.在本文中,我们将对Javascript中的原型继承进行一些探索. 基本形式 我们先来看下面一段代码: &lt;cod ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/1O5EO8W7z7/">安装和破解Navicat</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">这里的是安装目录,要记住 额外热任务在桌面创建一个快捷方式 点击完成之后先不要打开运行Navicat.exe这个主程序,把PatchNavicat.exe复制到你刚刚我们安装的路径,,不是你安装包的路 ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/n2d92ZZ6zD/">iOS 开开中textfield的一些记录</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">1.placehold 使用KVC机制改变占位符的颜色和大小 [textField&nbsp;setValue:[UIColor&nbsp;redColor]&nbsp;forKeyPath:@"_placeholder ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/n2d9GZRVJD/">如何提交内核补丁--checkpatch.pl使用【转】</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">转自:https://blog.csdn.net/qq_29350001/article/details/52056667 转自:&nbsp;http://blog.csdn.net/ganggexiongqi ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/xl56G7Gkdr/">Unity --- 纹理压缩基本知识点</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">1.Unity支持的压缩格式的分类,这里主要指Android平台和IOS平台: DXT格式 --- Nvidia Tegra(图睿)提供ETC &nbsp;--- 安卓原生支持的,OPNEGL2.0都支持,ET ...</p>
			</li>
						<li><a href="https://www.shuzhiduo.com/A/8Bz81Wy6Jx/">WinForm—串口通讯</a>
			<p style="color: rgba(0, 0, 0, 0.32);margin-bottom: 8px;">ialPort(串行端口资源) 常用属性: BaudRate 此串行端口上要使用的波特率 DataBits 每发送/接收一个字节的数据位数目 DtrEnable 在通讯过程中是否启用数据终端就绪(St ...</p>
			</li>
			</ol>			
							
					</div>

					
					<!--<div class="shareBox  clearfix">

					</div>-->
					<!--<div class="posts-cjtz content-cjtz clearfix"><img src="/images.grace/2865270162.png" alt="" /></div>	-->										<div class="next-prev-posts clearfix">
</div>
						 
				</div>
				
	<div class="clear"></div>

			<div class="google-auto-placed" style="width: 100%; height: auto; clear: both; text-align: center;"><ins data-ad-format="auto" class="adsbygoogle adsbygoogle-noablate" data-ad-client="ca-pub-9051032955849697" data-adsbygoogle-status="done" style="display: block; margin: 10px auto; background-color: transparent; height: 280px;"><div id="aswift_4_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none; height: 280px; width: 1120px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block; overflow: visible;"><iframe id="aswift_4" name="aswift_4" style="left:0;position:absolute;top:0;border:0;width:1120px;height:280px;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="1120" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-9051032955849697&amp;output=html&amp;h=280&amp;adk=2129524708&amp;adf=2329930180&amp;pi=t.aa~a.3350818252~rp.3&amp;w=1120&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1663753792&amp;rafmt=1&amp;to=qs&amp;pwprc=9822993290&amp;psa=1&amp;format=1120x280&amp;url=https%3A%2F%2Fwww.shuzhiduo.com%2FA%2Flk5a1WQm51%2F&amp;fwr=0&amp;pra=3&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=40&amp;uach=WyJXaW5kb3dzIiwiMC4xLjAiLCJ4ODYiLCIiLCIxMDUuMC41MTk1LjEyNyIsW10sZmFsc2UsbnVsbCwiNjQiLFtbIkdvb2dsZSBDaHJvbWUiLCIxMDUuMC41MTk1LjEyNyJdLFsiTm90KUE7QnJhbmQiLCI4LjAuMC4wIl0sWyJDaHJvbWl1bSIsIjEwNS4wLjUxOTUuMTI3Il1dLGZhbHNlXQ..&amp;dt=1663753773453&amp;bpp=1&amp;bdt=611&amp;idt=2&amp;shv=r20220915&amp;mjsv=m202209080101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3Df7314187d1585458-22ff8ab370cc0073%3AT%3D1634204227%3ART%3D1634204227%3AS%3DALNI_MahjDhlS5l9lyCPEBuoCBwD88Q75A&amp;gpic=UID%3D000009d3255c3bad%3AT%3D1663751820%3ART%3D1663751820%3AS%3DALNI_Mas9m9Ujtd4Rak-tm0JxwicINSJVw&amp;prev_fmts=0x0%2C1120x280%2C1120x280%2C728x90%2C1120x280&amp;nras=3&amp;correlator=3645671886148&amp;frm=20&amp;pv=1&amp;ga_vid=1484284127.1663753773&amp;ga_sid=1663753773&amp;ga_hid=377792994&amp;ga_fc=0&amp;u_tz=480&amp;u_his=9&amp;u_h=1440&amp;u_w=2560&amp;u_ah=1400&amp;u_aw=2560&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=712&amp;ady=8918&amp;biw=2543&amp;bih=1240&amp;scr_x=0&amp;scr_y=3998&amp;eid=44759876%2C44759927%2C44759842%2C42531705%2C44773614&amp;oid=2&amp;psts=APxP-9DwjU3w9ms9Gz4QzLnT05b73LnFkx48gZtKvNfsP3X0tVbNEJFRlMUVe8oBrvnePCKwQrvHuS1JPEX_4sE6iQ%2CAPxP-9DiA3sGF-Fir_gEoKxJ59MvXVaIkB_DFFzlNiWvrjmNBu-ONO44dqCH5CKV0zlWNlY6fYQgYb68hA2v6ep4kA%2CAPxP-9BfB9nGG4wrqmTDbrcKQ7ycA4OnvBJaP38s-COixDm3NqQnIFrOoKZUGdpgY-HRan6e4oMolqbmck_8zRX5Iw&amp;pvsid=2296454610742570&amp;tmod=2134688571&amp;uas=3&amp;nvt=1&amp;ref=https%3A%2F%2Fwww.shuzhiduo.com%2FA%2F8Bz8qOYXJx%2F&amp;eae=0&amp;fc=1920&amp;brdim=0%2C0%2C0%2C0%2C2560%2C0%2C2560%2C1400%2C2560%2C1240&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;ifi=5&amp;uci=a!5&amp;btvi=3&amp;fsb=1&amp;xpc=qlGHaMi1rk&amp;p=https%3A//www.shuzhiduo.com&amp;dtd=18611" data-google-container-id="a!5"></iframe></div></ins></div></div>	
			
	<div class="widget"><h3><span>热门专题</span></h3>
		<div class="widge_tags">
											<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/%e6%9c%8d%e5%8a%a1%e5%99%a8audit%e8%a7%84%e5%88%99/" title="服务器audit规则">服务器audit规则</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/%e5%9c%a8%e8%be%93%e5%85%a5%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%b8%ad%e6%9f%a5%e6%89%be%e6%98%af%e5%90%a6%e6%9c%89%e5%ad%97%e7%ac%a6k/" title="在输入的字符串中查找是否有字符k">在输入的字符串中查找是否有字符k</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/linux-%e6%80%8e%e4%b9%88%e6%a0%b7%e6%b7%bb%e5%8a%a0python3%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f/" title="linux 怎么样添加python3环境变量">linux 怎么样添加python3环境变量</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/python%e5%a6%82%e4%bd%95%e6%9f%a5%e7%9c%8b%e5%bd%93%e5%89%8d%e9%a1%b9%e7%9b%ae%e6%89%80%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83/" title="python如何查看当前项目所运行环境">python如何查看当前项目所运行环境</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/final%e8%83%bd%e5%ae%9e%e7%8e%b0c-%e7%9a%84%e7%b1%bb%e4%b8%8d%e8%83%bd%e7%bb%a7%e6%89%bf%e4%b9%88/" title="final能实现C 的类不能继承么">final能实现C 的类不能继承么</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/openssl-%e6%89%be%e4%b8%8d%e5%88%b0bio%e7%bb%93%e6%9e%84%e4%bd%93/" title="openssl 找不到BIO结构体">openssl 找不到BIO结构体</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/stm32%e5%88%a4%e6%96%ad%e6%8c%89%e9%92%ae%e7%9f%ad%e6%8c%89%e4%b8%8e%e9%95%bf%e5%ae%89/" title="stm32判断按钮短按与长安">stm32判断按钮短按与长安</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/serializearray%e5%a4%9a%e7%bb%b4/" title="serializeArray多维">serializeArray多维</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/tabel%e6%a0%87%e7%ad%be%e5%b1%9e%e6%80%a7%e8%be%b9%e6%a1%86%e5%ae%9e%e7%ba%bf/" title="tabel标签属性边框实线">tabel标签属性边框实线</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/weui%e6%97%b6%e9%97%b4%e7%bb%84%e4%bb%b6%e5%8f%aa%e6%98%be%e7%a4%ba%e5%bd%93%e5%89%8d%e6%97%b6%e9%97%b4/" title="weui时间组件只显示当前时间">weui时间组件只显示当前时间</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/jetbrains%e5%ad%a6%e7%94%9f%e7%89%88%e5%85%b6%e4%bb%96%e7%9a%84%e8%bd%af%e4%bb%b6/" title="jetbrains学生版其他的软件">jetbrains学生版其他的软件</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/%e6%98%be%e7%a4%ba%e4%b8%8a%e4%b8%aa%e5%91%bd%e4%bb%a4%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6%e9%97%b4/" title="显示上个命令的运行时间">显示上个命令的运行时间</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/redisdao-getkey-%e8%8e%b7%e5%8f%96%e4%b8%8d%e5%88%b0%e6%9c%80%e6%96%b0%e7%9a%84%e6%95%b0%e6%8d%ae/" title="redisDao.getkey 获取不到最新的数据">redisDao.getkey 获取不到最新的数据</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/python-%e7%ae%80%e5%8d%95%e7%9a%84class%e5%8c%85%e5%90%ab%e9%9a%90%e8%97%8f%e5%87%bd%e6%95%b0%e7%9a%84/" title="python 简单的class包含隐藏函数的">python 简单的class包含隐藏函数的</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/sklearn%e6%9c%89%e5%93%aa%e4%ba%9b%e6%95%b0%e6%8d%ae%e9%9b%86/" title="sklearn有哪些数据集">sklearn有哪些数据集</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/vscode%e7%bb%88%e7%ab%af%e8%bf%9b%e7%a8%8b%e5%90%af%e5%8a%a8%e5%a4%b1%e8%b4%a5shell%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6/" title="vscode终端进程启动失败shell可执行文件">vscode终端进程启动失败shell可执行文件</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/openflow%e6%9e%b6%e6%9e%84%e4%b8%ad%e7%94%b1%e6%8e%a7%e5%88%b6%e5%99%a8%e5%8f%91%e7%bb%99%e4%ba%a4%e6%8d%a2%e6%9c%ba%e7%9a%84%e6%8a%a5%e6%96%87-%e5%85%b6%e7%b1%bb%e5%9e%8b%e5%8f%af%e8%83%bd%e6%98%af/" title="OpenFlow架构中由控制器发给交换机的报文,其类型可能是">OpenFlow架构中由控制器发给交换机的报文,其类型可能是</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/%e9%a1%b9%e7%9b%ae%e5%90%af%e5%8a%a8%e9%9d%99%e6%80%81%e9%a1%b5%e9%9d%a2%e4%b8%ad%e6%96%87%e4%b9%b1%e7%a0%81/" title="项目启动静态页面中文乱码">项目启动静态页面中文乱码</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/%e6%b5%81%e5%bc%8f%e8%ae%a1%e7%ae%97-%e4%b8%80-java8stream/" title="流式计算(一)-Java8Stream">流式计算(一)-Java8Stream</a>				</div>
								<div class="tag-items" style="float: left;">
					<a href="https://www.shuzhiduo.com/topic/qt%e9%94%ae%e7%9b%98%e4%ba%8b%e4%bb%b6%e6%b2%a1%e6%9c%89%e7%84%a6%e7%82%b9%e6%80%8e%e4%b9%88%e5%8a%9e/" title="qt键盘事件没有焦点怎么办">qt键盘事件没有焦点怎么办</a>				</div>
									</div>
	</div>

		</div>
</div>
</div>


<div class="clearfix"></div>
<div id="footer" class="two-s-footer">
	<div class="footer-box">
		<div class="container">
			<div class="row" style="padding-left: 15px;padding-right: 15px;">
			<div class="nav-footer">
				<a href="https://www.shuzhiduo.com/">Home</a>
				</div>
				<div class="copyright-footer">
					<p>Powered By WordPress</p>
				</div>
							</div>
		</div>
	</div>
</div>
<div style="display:none">

</div>
<script src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/echo.js.下载"></script>
<script>
    echo.init({
      offset: 100,
      throttle: 250,
      unload: false,
      callback: function (element, op) {
        console.log(element, 'has been', op + 'ed')
      }
    });


	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?f15ef43e2286a8db87bbc840d67d46b2";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
  
 </script>


</div><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" style="display: none !important;" data-ad-status="unfilled"><div id="aswift_0_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none; height: 0px; width: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block;"><iframe id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0;width:undefinedpx;height:undefinedpx;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/ads(2).html" data-google-container-id="a!1" data-load-complete="true"></iframe></div></ins><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" data-anchor-status="displayed" style="display: block; width: 100% !important; height: 95px !important; bottom: 0px; clear: none !important; float: none !important; left: 0px; margin: 0px !important; max-height: none !important; max-width: none !important; opacity: 1; overflow: visible !important; padding: 0px !important; position: fixed; right: auto !important; top: auto !important; vertical-align: baseline !important; visibility: visible !important; z-index: 2147483647; background: rgb(250, 250, 250) !important;" data-ad-status="filled" data-anchor-shown="true"><div class="grippy-host"></div><div id="aswift_5_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border: none !important; height: 90px !important; width: 100% !important; margin: 0px !important; padding: 0px !important; position: relative !important; visibility: visible !important; background-color: transparent !important; display: inline-block !important; inset: auto !important; clear: none !important; float: none !important; max-height: none !important; max-width: none !important; opacity: 1 !important; overflow: visible !important; vertical-align: baseline !important; z-index: auto !important;"><iframe id="aswift_5" name="aswift_5" style="width: 728px !important; height: 90px !important; display: block; margin: 0px auto;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/zrt_lookup.html" data-google-container-id="a!6" data-google-query-id="CI-BweXNpfoCFaeH6QUdxOEJZA" data-load-complete="true"></iframe></div></ins><iframe src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/aframe.html" width="0" height="0" style="display: none;"></iframe></body><iframe id="google_esf" name="google_esf" src="./基于FFmpeg的Dxva2硬解码及Direct3D显示（四）_files/zrt_lookup(1).html" style="display: none;"></iframe></html>